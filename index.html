<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChemLab: Qualitative Analysis</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // --- ICONS ---
        
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const FlaskConical = (props) => (
            <IconBase {...props}>
                <path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2" />
                <path d="M8.5 2h7" />
                <path d="M7 16h10" />
            </IconBase>
        );

        const Beaker = (props) => (
            <IconBase {...props}>
                <path d="M4.5 3h15" />
                <path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3" />
                <path d="M6 14h12" />
            </IconBase>
        );

        const TestTube = (props) => (
            <IconBase {...props}>
                <path d="M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2" />
                <path d="M8.5 2h7" />
                <path d="M14.5 16h-5" />
            </IconBase>
        );

        const CheckCircle2 = (props) => (
            <IconBase {...props}>
                <circle cx="12" cy="12" r="10" />
                <path d="m9 12 2 2 4-4" />
            </IconBase>
        );

        const XCircle = (props) => (
            <IconBase {...props}>
                <circle cx="12" cy="12" r="10" />
                <path d="m15 9-6 6" />
                <path d="m9 9 6 6" />
            </IconBase>
        );

        const ArrowRight = (props) => (
            <IconBase {...props}>
                <path d="M5 12h14" />
                <path d="m12 5 7 7-7 7" />
            </IconBase>
        );

        const RefreshCw = (props) => (
            <IconBase {...props}>
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
                <path d="M21 3v5h-5" />
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
                <path d="M8 16H3v5" />
            </IconBase>
        );

        const Trophy = (props) => (
            <IconBase {...props}>
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
                <path d="M4 22h16" />
                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" />
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" />
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
            </IconBase>
        );

        const Flame = (props) => (
            <IconBase {...props}>
                <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" />
            </IconBase>
        );

        const Microscope = (props) => (
            <IconBase {...props}>
                <path d="M6 18h8" />
                <path d="M3 22h18" />
                <path d="M14 22a7 7 0 1 0 0-14h-1" />
                <path d="M9 14h2" />
                <path d="M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z" />
                <path d="M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3" />
            </IconBase>
        );

        const Search = (props) => (
            <IconBase {...props}>
                <circle cx="11" cy="11" r="8" />
                <path d="m21 21-4.3-4.3" />
            </IconBase>
        );

        const FileText = (props) => (
            <IconBase {...props}>
                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                <polyline points="14 2 14 8 20 8" />
                <line x1="16" y1="13" x2="8" y2="13" />
                <line x1="16" y1="17" x2="8" y2="17" />
                <line x1="10" y1="9" x2="8" y2="9" />
            </IconBase>
        );

        const Droplets = (props) => (
            <IconBase {...props}>
                <path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z" />
                <path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.35" />
            </IconBase>
        );

        const Thermometer = (props) => (
            <IconBase {...props}>
                <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z" />
            </IconBase>
        );

        const AlertTriangle = (props) => (
            <IconBase {...props}>
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
                <line x1="12" y1="9" x2="12" y2="13" />
                <line x1="12" y1="17" x2="12.01" y2="17" />
            </IconBase>
        );

        const RotateCcw = (props) => (
            <IconBase {...props}>
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                <path d="M3 3v5h5" />
            </IconBase>
        );

        const Eye = (props) => (
            <IconBase {...props}>
                <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
                <circle cx="12" cy="12" r="3" />
            </IconBase>
        );

        const BookOpen = (props) => (
            <IconBase {...props}>
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
            </IconBase>
        );

        const PenTool = (props) => (
            <IconBase {...props}>
                <path d="m12 19 7-7 3 3-7 7-3-3z" />
                <path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z" />
                <path d="m2 2 7.586 7.586" />
                <circle cx="11" cy="11" r="2" />
            </IconBase>
        );

        const Lightbulb = (props) => (
            <IconBase {...props}>
                <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2.4 1.5-3.8 0-3.2-2.5-5.7-5.7-5.7C9 2 6.2 4.8 6.2 8.3c0 1.4.5 2.7 1.5 3.7.8.8 1.3 1.5 1.5 2.5" />
                <path d="M9 18h6" />
                <path d="M10 22h4" />
            </IconBase>
        );

        // --- INORGANIC DATASETS & LOGIC ---

        const CATIONS = [
            { id: 'Cu2+', name: 'Copper(II) (Cu²⁺)', simpleName: 'Copper(II)', color: 'blue', solidColor: 'blue/green crystalline', flame: 'Bluish-green' },
            { id: 'Fe2+', name: 'Iron(II) (Fe²⁺)', simpleName: 'Iron(II)', color: 'pale green', solidColor: 'pale green crystalline', flame: 'No observable change' },
            { id: 'Fe3+', name: 'Iron(III) (Fe³⁺)', simpleName: 'Iron(III)', color: 'yellow/brown', solidColor: 'yellow/brown crystalline', flame: 'No observable change' },
            { id: 'Ca2+', name: 'Calcium (Ca²⁺)', simpleName: 'Calcium', color: 'colorless', solidColor: 'white crystalline', flame: 'Brick Red' },
            { id: 'Mg2+', name: 'Magnesium (Mg²⁺)', simpleName: 'Magnesium', color: 'colorless', solidColor: 'white crystalline', flame: 'No observable change' },
            { id: 'Al3+', name: 'Aluminium (Al³⁺)', simpleName: 'Aluminium', color: 'colorless', solidColor: 'white crystalline', flame: 'No observable change' },
            { id: 'Zn2+', name: 'Zinc (Zn²⁺)', simpleName: 'Zinc', color: 'colorless', solidColor: 'white crystalline', flame: 'No observable change' },
            { id: 'NH4+', name: 'Ammonium (NH₄⁺)', simpleName: 'Ammonium', color: 'colorless', solidColor: 'white crystalline', flame: 'No observable change' },
            { id: 'Na+', name: 'Sodium (Na⁺)', simpleName: 'Sodium', color: 'colorless', solidColor: 'white crystalline', flame: 'Golden Yellow' },
            { id: 'K+', name: 'Potassium (K⁺)', simpleName: 'Potassium', color: 'colorless', solidColor: 'white crystalline', flame: 'Lilac' },
        ];

        const ANIONS = [
            { id: 'Cl-', name: 'Chloride (Cl⁻)', simpleName: 'Chloride' },
            { id: 'Br-', name: 'Bromide (Br⁻)', simpleName: 'Bromide' },
            { id: 'I-', name: 'Iodide (I⁻)', simpleName: 'Iodide' },
            { id: 'SO4-2', name: 'Sulphate (SO₄²⁻)', simpleName: 'Sulphate' },
            { id: 'NO3-', name: 'Nitrate (NO₃⁻)', simpleName: 'Nitrate' },
            { id: 'CO3-2', name: 'Carbonate (CO₃²⁻)', simpleName: 'Carbonate' },
            { id: 'HCO3-', name: 'Hydrogencarbonate (HCO₃⁻)', simpleName: 'Hydrogencarbonate' },
            { id: 'SO3-2', name: 'Sulphite (SO₃²⁻)', simpleName: 'Sulphite' },
            { id: 'OCl-', name: 'Hypochlorite (OCl⁻)', simpleName: 'Hypochlorite' }, 
        ];

        const generateMysteryCompound = () => {
            let isValid = false;
            let c, a;
            
            let attempts = 0;
            while (!isValid && attempts < 500) {
                attempts++;
                c = CATIONS[Math.floor(Math.random() * CATIONS.length)];
                a = ANIONS[Math.floor(Math.random() * ANIONS.length)];
                
                if (['Na+', 'K+', 'NH4+'].includes(c.id)) isValid = true; 
                else if (['NO3-', 'HCO3-'].includes(a.id)) isValid = true; 
                else if (a.id === 'SO4-2') isValid = c.id !== 'Ca2+'; 
                else if (['Cl-', 'Br-', 'I-'].includes(a.id)) { 
                    if (c.id === 'Cu2+' && a.id === 'I-') isValid = false; 
                    else if (c.id === 'Fe3+' && a.id === 'I-') isValid = false; 
                    else isValid = true;
                }
                else if (['CO3-2', 'SO3-2'].includes(a.id)) isValid = false; 
                else if (a.id === 'OCl-') isValid = true;
            }
            return { cation: c, anion: a };
        };

        const getTestReport = (cation, anion) => {
            const cId = cation.id;
            const aId = anion.id;

            return [
                { test: 'Visual Inspection', obs: `The sample is a ${cation.solidColor} solid.` },
                { test: 'Solubility Test', obs: `Dissolves completely in distilled water to form a ${cation.color} solution.` },
                { 
                    test: 'Flame Test', 
                    obs: ['K+', 'Na+', 'Cu2+', 'Ca2+'].includes(cId) ? `Flame burns with a ${cation.flame} color.` : 'No observable change.' 
                },
                { 
                    test: 'Add dilute NaOH(aq)', 
                    obs: (() => {
                        if (cId === 'Cu2+') return 'Blue precipitate forms.';
                        if (cId === 'Fe2+') return 'Dirty green precipitate forms.';
                        if (cId === 'Fe3+') return 'Reddish-brown precipitate forms.';
                        if (['Ca2+', 'Mg2+', 'Al3+', 'Zn2+'].includes(cId)) return 'White precipitate forms.';
                        if (cId === 'NH4+') return 'No visible precipitate.';
                        return 'No visible precipitate.';
                    })()
                },
                {
                    test: 'Add excess NaOH(aq)',
                    obs: (() => {
                        if (['Zn2+', 'Al3+'].includes(cId)) return 'The white precipitate dissolves to form a colorless solution.';
                        if (['Ca2+', 'Mg2+', 'Cu2+', 'Fe2+', 'Fe3+'].includes(cId)) return 'The precipitate remains insoluble.';
                        if (cId === 'NH4+') return 'No precipitate forms. On warming, a pungent gas is evolved which turns wet pH paper blue.';
                        return 'No precipitate forms.';
                    })()
                },
                { 
                    test: 'Add dilute NH₃(aq)', 
                    obs: (() => {
                        if (cId === 'Cu2+') return 'Pale blue precipitate forms.';
                        if (cId === 'Fe2+') return 'Dirty green precipitate forms.';
                        if (cId === 'Fe3+') return 'Reddish-brown precipitate forms.';
                        if (['Zn2+', 'Mg2+', 'Al3+'].includes(cId)) return 'White precipitate forms.';
                        return 'No precipitate.';
                    })()
                },
                {
                    test: 'Add excess NH₃(aq)',
                    obs: cId === 'Cu2+' ? 'Precipitate dissolves to form a DEEP BLUE solution.' :
                        (cId === 'Zn2+' ? 'Precipitate dissolves to form a colorless solution.' :
                        (['Al3+', 'Mg2+', 'Fe2+', 'Fe3+'].includes(cId) ? 'Precipitate remains insoluble.' : 'N/A.'))
                },
                {
                    test: 'Add dilute HCl(aq)',
                    obs: (() => {
                        if (aId === 'CO3-2' || aId === 'HCO3-') return 'Vigorous effervescence. Colorless gas turns wet pH paper red.';
                        if (aId === 'SO3-2') return 'Effervescence. Pungent gas (burning sulphur smell) turns wet pH paper red.';
                        if (aId === 'OCl-') return 'Pungent gas evolved. Gas turns wet pH paper red, then bleaches it white.';
                        return 'No gas bubbles observed.';
                    })()
                },
                {
                    test: 'Add acidified BaCl₂(aq)',
                    obs: aId === 'SO4-2' ? 'White precipitate forms.' : 'No precipitate forms.'
                },
                {
                    test: 'Add acidified AgNO₃(aq)',
                    obs: (() => {
                        if (aId === 'Cl-') return 'White precipitate forms.';
                        if (aId === 'Br-') return 'Pale yellow precipitate forms.';
                        if (aId === 'I-') return 'Yellow precipitate forms.';
                        if (aId === 'OCl-') return 'White precipitate forms.';
                        return 'No precipitate forms.';
                    })()
                },
                {
                    test: 'Add Na₂SO₄(aq)',
                    obs: cId === 'Ca2+' ? 'White precipitate forms.' : 'No precipitate forms.'
                }
            ];
        };

        // --- COMPLEX ORGANIC STRUCTURES (SVGs) ---
        // Updated Wrapper: Increased viewBox to 400 width to accommodate Hexanoic Acid's COOH
        const SvgWrapper = ({ children, viewBox="-40 -50 400 250" }) => (
            <svg viewBox={viewBox} className={`w-full h-40 stroke-slate-800 mx-auto`} strokeWidth="2.5" fill="none" strokeLinecap="round" strokeLinejoin="round">
                {children}
            </svg>
        );

        const TextLabel = ({x, y, text, fontSize="18"}) => (
            <text x={x} y={y} fontSize={fontSize} fontFamily="sans-serif" fontWeight="600" textAnchor="middle" alignmentBaseline="middle" fill="currentColor" stroke="none">{text}</text>
        );

        const BenzeneRing = ({cx=60, cy=70, r=30}) => {
            const h = r * 0.866; 
            const r2 = r * 0.5;  
            const points = `
                ${cx},${cy-r} 
                ${cx+h},${cy-r2} 
                ${cx+h},${cy+r2} 
                ${cx},${cy+r} 
                ${cx-h},${cy+r2} 
                ${cx-h},${cy-r2}
            `;
            return (
                <g>
                    <polygon points={points} />
                    <circle cx={cx} cy={cy} r={r*0.6} />
                </g>
            );
        };

        // --- Complex Structures ---

        const Struct4Hydroxybenzaldehyde = () => (
            <SvgWrapper viewBox="-30 -30 260 220">
                <BenzeneRing cx={100} cy={80} />
                <line x1="100" y1="50" x2="100" y2="25" />
                <line x1="100" y1="25" x2="115" y2="15" /> 
                <TextLabel x="122" y="15" text="H" />
                <line x1="98" y1="25" x2="83" y2="15" /> 
                <line x1="102" y1="25" x2="87" y2="15" />
                <TextLabel x="80" y="12" text="O" />
                <line x1="100" y1="110" x2="100" y2="130" />
                <TextLabel x="100" y="145" text="OH" />
            </SvgWrapper>
        );

        const Struct4Hydroxyacetophenone = () => (
            <SvgWrapper viewBox="-30 -30 260 220">
                <BenzeneRing cx={100} cy={80} />
                <line x1="100" y1="50" x2="100" y2="25" />
                <line x1="98" y1="25" x2="83" y2="15" />
                <line x1="102" y1="25" x2="87" y2="15" />
                <TextLabel x="80" y="12" text="O" />
                <line x1="100" y1="25" x2="125" y2="15" />
                <TextLabel x="140" y="15" text="CH₃" />
                <line x1="100" y1="110" x2="100" y2="130" />
                <TextLabel x="100" y="145" text="OH" />
            </SvgWrapper>
        );

        const StructSalicylicAcid = () => (
            <SvgWrapper viewBox="-30 -30 260 220">
                <BenzeneRing cx={80} cy={80} />
                <line x1="106" y1="65" x2="130" y2="50" />
                <line x1="130" y1="50" x2="130" y2="30" />
                <line x1="134" y1="50" x2="134" y2="30" />
                <TextLabel x="132" y="20" text="O" />
                <line x1="130" y1="50" x2="150" y2="60" />
                <TextLabel x="165" y="65" text="OH" />
                <line x1="106" y1="95" x2="130" y2="110" />
                <TextLabel x="145" y="115" text="OH" />
            </SvgWrapper>
        );

        const StructMethylSalicylate = () => (
            <SvgWrapper viewBox="-30 -30 280 220">
                <BenzeneRing cx={80} cy={80} />
                <line x1="106" y1="65" x2="130" y2="50" />
                <line x1="130" y1="50" x2="130" y2="30" /> 
                <line x1="134" y1="50" x2="134" y2="30" />
                <TextLabel x="132" y="20" text="O" />
                <line x1="130" y1="50" x2="150" y2="60" /> 
                <TextLabel x="160" y="65" text="O" />
                <line x1="170" y1="65" x2="185" y2="55" />
                <TextLabel x="200" y="55" text="CH₃" />
                <line x1="106" y1="95" x2="130" y2="110" />
                <TextLabel x="145" y="115" text="OH" />
            </SvgWrapper>
        );

        const Struct5HexenoicAcid = () => (
            <SvgWrapper viewBox="-30 0 380 120">
                <TextLabel x="20" y="50" text="CH₂" />
                <line x1="40" y1="45" x2="60" y2="45" /> 
                <line x1="40" y1="55" x2="60" y2="55" />
                <TextLabel x="75" y="50" text="CH" />
                <line x1="90" y1="50" x2="110" y2="50" />
                <TextLabel x="130" y="50" text="CH₂" />
                <line x1="150" y1="50" x2="170" y2="50" />
                <TextLabel x="190" y="50" text="CH₂" />
                <line x1="210" y1="50" x2="230" y2="50" />
                <TextLabel x="250" y="50" text="CH₂" />
                <line x1="270" y1="50" x2="290" y2="50" />
                <TextLabel x="320" y="50" text="COOH" />
            </SvgWrapper>
        );

        const StructHexanoicAcid = () => (
            <SvgWrapper viewBox="-30 0 420 120">
                <TextLabel x="20" y="50" text="CH₃" />
                <line x1="40" y1="50" x2="60" y2="50" />
                <TextLabel x="80" y="50" text="CH₂" />
                <line x1="100" y1="50" x2="120" y2="50" />
                <TextLabel x="140" y="50" text="CH₂" />
                <line x1="160" y1="50" x2="180" y2="50" />
                <TextLabel x="200" y="50" text="CH₂" />
                <line x1="220" y1="50" x2="240" y2="50" />
                <TextLabel x="260" y="50" text="CH₂" />
                <line x1="280" y1="50" x2="300" y2="50" />
                <TextLabel x="330" y="50" text="COOH" />
            </SvgWrapper>
        );

        const Struct4OxopentanoicAcid = () => (
            <SvgWrapper viewBox="-20 -20 320 140">
                <TextLabel x="20" y="60" text="CH₃" />
                <line x1="45" y1="60" x2="65" y2="60" />
                <line x1="65" y1="60" x2="65" y2="35" /> 
                <line x1="70" y1="60" x2="70" y2="35" />
                <TextLabel x="68" y="20" text="O" />
                <line x1="70" y1="60" x2="95" y2="60" />
                <TextLabel x="115" y="60" text="CH₂" />
                <line x1="135" y1="60" x2="155" y2="60" />
                <TextLabel x="175" y="60" text="CH₂" />
                <line x1="195" y1="60" x2="215" y2="60" />
                <TextLabel x="245" y="60" text="COOH" />
            </SvgWrapper>
        );

        const Struct4HydroxypentanoicAcid = () => (
            <SvgWrapper viewBox="-20 -20 320 140">
                <TextLabel x="20" y="60" text="CH₃" />
                <line x1="45" y1="60" x2="65" y2="60" />
                <TextLabel x="80" y="60" text="CH" />
                <line x1="80" y1="45" x2="80" y2="30" />
                <TextLabel x="80" y="15" text="OH" />
                <line x1="95" y1="60" x2="115" y2="60" />
                <TextLabel x="135" y="60" text="CH₂" />
                <line x1="155" y1="60" x2="175" y2="60" />
                <TextLabel x="195" y="60" text="CH₂" />
                <line x1="215" y1="60" x2="235" y2="60" />
                <TextLabel x="265" y="60" text="COOH" />
            </SvgWrapper>
        );

        const StructCinnamaldehyde = () => (
            <SvgWrapper viewBox="-30 -30 280 220">
                <BenzeneRing cx={60} cy={80} />
                <line x1="86" y1="65" x2="110" y2="50" />
                <TextLabel x="120" y="45" text="CH" />
                <line x1="135" y1="40" x2="160" y2="40" />
                <line x1="135" y1="46" x2="160" y2="46" />
                <TextLabel x="175" y="45" text="CH" />
                <line x1="190" y1="45" x2="210" y2="60" />
                <TextLabel x="230" y="75" text="CHO" />
            </SvgWrapper>
        );

        const StructCinnamicAcid = () => (
            <SvgWrapper viewBox="-30 -30 280 220">
                <BenzeneRing cx={60} cy={80} />
                <line x1="86" y1="65" x2="110" y2="50" />
                <TextLabel x="120" y="45" text="CH" />
                <line x1="135" y1="40" x2="160" y2="40" /> 
                <line x1="135" y1="46" x2="160" y2="46" />
                <TextLabel x="175" y="45" text="CH" />
                <line x1="190" y1="45" x2="210" y2="60" />
                <TextLabel x="245" y="75" text="COOH" />
            </SvgWrapper>
        );

        const StructVanillin = () => (
            <SvgWrapper viewBox="-30 -30 240 220">
                <BenzeneRing cx={100} cy={80} />
                <line x1="100" y1="50" x2="100" y2="30" />
                <TextLabel x="100" y="15" text="CHO" />
                <line x1="126" y1="65" x2="145" y2="55" />
                <TextLabel x="165" y="50" text="OCH₃" />
                <line x1="126" y1="95" x2="145" y2="105" />
                <TextLabel x="160" y="110" text="OH" />
            </SvgWrapper>
        );

        const StructPhenylethene = () => (
            <SvgWrapper viewBox="-30 -30 240 220">
                <BenzeneRing cx={80} cy={80} />
                <line x1="106" y1="65" x2="130" y2="50" />
                <TextLabel x="140" y="45" text="CH" />
                <line x1="155" y1="40" x2="180" y2="40" />
                <line x1="155" y1="46" x2="180" y2="46" />
                <TextLabel x="195" y="45" text="CH₂" />
            </SvgWrapper>
        );

        const Struct2Phenylethanol = () => (
            <SvgWrapper viewBox="-30 -30 260 220">
                <BenzeneRing cx={60} cy={80} />
                <line x1="86" y1="65" x2="110" y2="50" />
                <TextLabel x="130" y="45" text="CH₂" />
                <line x1="150" y1="45" x2="170" y2="45" />
                <TextLabel x="190" y="45" text="CH₂" />
                <line x1="210" y1="45" x2="225" y2="55" />
                <TextLabel x="235" y="70" text="OH" />
            </SvgWrapper>
        );

        const StructEthylBenzoate = () => (
            <SvgWrapper viewBox="-30 -30 260 220">
                <BenzeneRing cx={60} cy={80} />
                <line x1="86" y1="65" x2="110" y2="50" />
                <line x1="110" y1="50" x2="110" y2="30" />
                <line x1="114" y1="50" x2="114" y2="30" />
                <TextLabel x="112" y="15" text="O" />
                <line x1="112" y1="50" x2="130" y2="60" />
                <TextLabel x="140" y="65" text="O" />
                <line x1="150" y1="65" x2="170" y2="55" />
                <TextLabel x="190" y="50" text="CH₂" />
                <line x1="210" y1="50" x2="230" y2="50" />
                <TextLabel x="250" y="50" text="CH₃" />
            </SvgWrapper>
        );

        const StructBenzoicAcid = () => (
            <SvgWrapper viewBox="-30 -30 220 220">
                <BenzeneRing cx={100} cy={80} />
                <line x1="100" y1="50" x2="100" y2="25" />
                <TextLabel x="100" y="10" text="COOH" />
            </SvgWrapper>
        );

        const StructEthanoicAcid = () => (
            <SvgWrapper viewBox="-20 -30 200 160">
                <TextLabel x="20" y="60" text="CH₃" />
                <line x1="45" y1="60" x2="75" y2="60" />
                <line x1="75" y1="60" x2="95" y2="30" /> 
                <line x1="80" y1="63" x2="100" y2="33" /> 
                <TextLabel x="105" y="25" text="O" />
                <line x1="75" y1="60" x2="95" y2="90" /> 
                <TextLabel x="110" y="100" text="OH" />
            </SvgWrapper>
        );

        const COMPLEX_PAIRS = [
            { id: 1, nameA: "4-Hydroxybenzaldehyde", nameB: "4-Hydroxyacetophenone", structA: <Struct4Hydroxybenzaldehyde/>, structB: <Struct4Hydroxyacetophenone/>, correctTest: "Add Tollen's Reagent and warm", correctObsDiff: "Aldehyde: Silver mirror vs Ketone: No Change" },
            { id: 2, nameA: "Salicylic Acid", nameB: "Methyl Salicylate", structA: <StructSalicylicAcid/>, structB: <StructMethylSalicylate/>, correctTest: "Add Na₂CO₃(aq)", correctObsDiff: "Acid: Effervescence vs Ester: No Change" },
            { id: 3, nameA: "5-Hexenoic Acid", nameB: "Hexanoic Acid", structA: <Struct5HexenoicAcid/>, structB: <StructHexanoicAcid/>, correctTest: "Add Br₂ (dissolved in organic solvent)", correctObsDiff: "Alkene: Decolorizes vs Alkane: No Change" },
            { id: 4, nameA: "4-Oxopentanoic Acid", nameB: "4-Hydroxypentanoic Acid", structA: <Struct4OxopentanoicAcid/>, structB: <Struct4HydroxypentanoicAcid/>, correctTest: "Add 2,4-Dinitrophenylhydrazine", correctObsDiff: "Ketone: Orange ppt vs Alcohol: No Change" },
            { id: 5, nameA: "Cinnamaldehyde", nameB: "Cinnamic Acid", structA: <StructCinnamaldehyde/>, structB: <StructCinnamicAcid/>, correctTest: "Add Na₂CO₃(aq)", correctObsDiff: "Aldehyde: No Change vs Acid: Effervescence" },
            { id: 6, nameA: "Vanillin", nameB: "4-Hydroxyacetophenone", structA: <StructVanillin/>, structB: <Struct4Hydroxyacetophenone/>, correctTest: "Add Tollen's Reagent and warm", correctObsDiff: "Aldehyde: Silver mirror vs Ketone: No Change" },
            { id: 7, nameA: "Benzoic Acid", nameB: "Ethyl Benzoate", structA: <StructBenzoicAcid/>, structB: <StructEthylBenzoate/>, correctTest: "Add Na₂CO₃(aq)", correctObsDiff: "Acid: Effervescence vs Ester: No Change" },
            { id: 8, nameA: "Phenylethene", nameB: "2-Phenylethanol", structA: <StructPhenylethene/>, structB: <Struct2Phenylethanol/>, correctTest: "Add Br₂ (dissolved in organic solvent)", correctObsDiff: "Alkene: Decolorizes vs Alcohol: No Change" },
            { id: 9, nameA: "4-Hydroxybenzaldehyde", nameB: "Salicylic Acid", structA: <Struct4Hydroxybenzaldehyde/>, structB: <StructSalicylicAcid/>, correctTest: "Add Na₂CO₃(aq)", correctObsDiff: "Phenol/Aldehyde: No Change vs Acid: Effervescence" },
            { id: 10, nameA: "5-Hexenoic Acid", nameB: "4-Oxopentanoic Acid", structA: <Struct5HexenoicAcid/>, structB: <Struct4OxopentanoicAcid/>, correctTest: "Add Br₂ (dissolved in organic solvent)", correctObsDiff: "Alkene: Decolorizes vs Ketone: No Change" },
            { id: 11, nameA: "Cinnamaldehyde", nameB: "Phenylethene", structA: <StructCinnamaldehyde/>, structB: <StructPhenylethene/>, correctTest: "Add Tollen's Reagent and warm", correctObsDiff: "Aldehyde: Silver mirror vs Alkene: No Change" },
            { id: 12, nameA: "Methyl Salicylate", nameB: "Salicylic Acid", structA: <StructMethylSalicylate/>, structB: <StructSalicylicAcid/>, correctTest: "Add Na₂CO₃(aq)", correctObsDiff: "Ester: No Change vs Acid: Effervescence" },
            { id: 13, nameA: "4-Hydroxypentanoic Acid", nameB: "4-Oxopentanoic Acid", structA: <Struct4HydroxypentanoicAcid/>, structB: <Struct4OxopentanoicAcid/>, correctTest: "Add acidified K₂Cr₂O₇ and warm", correctObsDiff: "Alcohol: Orange to Green vs Ketone: No Change" },
            { id: 14, nameA: "Vanillin", nameB: "Benzoic Acid", structA: <StructVanillin/>, structB: <StructBenzoicAcid/>, correctTest: "Add 2,4-Dinitrophenylhydrazine", correctObsDiff: "Aldehyde: Yellow/Orange ppt vs Acid: No Change", removeOption: "Add Na₂CO₃(aq)" },
            { id: 15, nameA: "Ethyl Benzoate", nameB: "Benzoic Acid", structA: <StructEthylBenzoate/>, structB: <StructBenzoicAcid/>, correctTest: "Add Na₂CO₃(aq)", correctObsDiff: "Ester: No Change vs Acid: Effervescence" },
            { id: 16, nameA: "4-Hydroxyacetophenone", nameB: "4-Hydroxybenzaldehyde", structA: <Struct4Hydroxyacetophenone/>, structB: <Struct4Hydroxybenzaldehyde/>, correctTest: "Add Tollen's Reagent and warm", correctObsDiff: "Ketone: No Change vs Aldehyde: Silver mirror" },
            { id: 17, nameA: "Cinnamic Acid", nameB: "Cinnamaldehyde", structA: <StructCinnamicAcid/>, structB: <StructCinnamaldehyde/>, correctTest: "Add Na₂CO₃(aq)", correctObsDiff: "Acid: Effervescence vs Aldehyde: No Change" },
            { id: 18, nameA: "2-Phenylethanol", nameB: "Phenylethene", structA: <Struct2Phenylethanol/>, structB: <StructPhenylethene/>, correctTest: "Add acidified KMnO₄", correctObsDiff: "Alcohol: No immediate decolorization vs Alkene: Decolorizes immediately" },
            { id: 19, nameA: "Hexanoic Acid", nameB: "5-Hexenoic Acid", structA: <StructHexanoicAcid/>, structB: <Struct5HexenoicAcid/>, correctTest: "Add Br₂ (dissolved in organic solvent)", correctObsDiff: "Alkane: No Change vs Alkene: Decolorizes" },
            { id: 20, nameA: "4-Hydroxyacetophenone", nameB: "Salicylic Acid", structA: <Struct4Hydroxyacetophenone/>, structB: <StructSalicylicAcid/>, correctTest: "Add 2,4-Dinitrophenylhydrazine", correctObsDiff: "Ketone: Orange ppt vs Acid: No Change", removeOption: "Add Na₂CO₃(aq)" },
            { id: 21, nameA: "Methyl Salicylate", nameB: "4-Hydroxybenzaldehyde", structA: <StructMethylSalicylate/>, structB: <Struct4Hydroxybenzaldehyde/>, correctTest: "Add Tollen's Reagent and warm", correctObsDiff: "Ester: No Change vs Aldehyde: Silver mirror" },
            { id: 22, nameA: "4-Oxopentanoic Acid", nameB: "Hexanoic Acid", structA: <Struct4OxopentanoicAcid/>, structB: <StructHexanoicAcid/>, correctTest: "Add 2,4-Dinitrophenylhydrazine", correctObsDiff: "Ketone: Orange ppt vs Acid: No Change", removeOption: "Add Na₂CO₃(aq)" },
            { id: 23, nameA: "Vanillin", nameB: "Methyl Salicylate", structA: <StructVanillin/>, structB: <StructMethylSalicylate/>, correctTest: "Add Tollen's Reagent and warm", correctObsDiff: "Aldehyde: Silver mirror vs Ester: No Change" },
            { id: 24, nameA: "Cinnamaldehyde", nameB: "2-Phenylethanol", structA: <StructCinnamaldehyde/>, structB: <Struct2Phenylethanol/>, correctTest: "Add Tollen's Reagent and warm", correctObsDiff: "Aldehyde: Silver mirror vs Alcohol: No Change" },
            { id: 25, nameA: "5-Hexenoic Acid", nameB: "4-Hydroxypentanoic Acid", structA: <Struct5HexenoicAcid/>, structB: <Struct4HydroxypentanoicAcid/>, correctTest: "Add Br₂ (dissolved in organic solvent)", correctObsDiff: "Alkene: Decolorizes vs Alcohol: No Change" },
            { id: 26, nameA: "Ethyl Benzoate", nameB: "4-Hydroxyacetophenone", structA: <StructEthylBenzoate/>, structB: <Struct4Hydroxyacetophenone/>, correctTest: "Add 2,4-Dinitrophenylhydrazine", correctObsDiff: "Ester: No Change vs Ketone: Orange ppt" },
            { id: 27, nameA: "Salicylic Acid", nameB: "Cinnamic Acid", structA: <StructSalicylicAcid/>, structB: <StructCinnamicAcid/>, correctTest: "Add Br₂ (dissolved in organic solvent)", correctObsDiff: "Phenol: No rapid change vs Alkene: Rapid decolorization" },
            { id: 28, nameA: "4-Hydroxybenzaldehyde", nameB: "4-Hydroxypentanoic Acid", structA: <Struct4Hydroxybenzaldehyde/>, structB: <Struct4HydroxypentanoicAcid/>, correctTest: "Add Tollen's Reagent and warm", correctObsDiff: "Aldehyde: Silver mirror vs Alcohol: No Change" },
            { id: 29, nameA: "4-Oxopentanoic Acid", nameB: "4-Hydroxyacetophenone", structA: <Struct4OxopentanoicAcid/>, structB: <Struct4Hydroxyacetophenone/>, correctTest: "Add Na₂CO₃(aq)", correctObsDiff: "Acid: Effervescence vs Phenol: No Change" },
            { id: 30, nameA: "Cinnamic Acid", nameB: "Benzoic Acid", structA: <StructCinnamicAcid/>, structB: <StructBenzoicAcid/>, correctTest: "Add Br₂ (dissolved in organic solvent)", correctObsDiff: "Alkene: Decolorizes vs Aromatic Acid: No Change" }
        ];

        const generateDistractors = (pair) => {
            const [partA, partB] = pair.correctObsDiff.split(" vs ");
            const [roleA, obsA] = partA.split(": ");
            const [roleB, obsB] = partB.split(": ");
            const falseAttribution = `${roleA}: ${obsB} vs ${roleB}: ${obsA}`;

            const options = [
                {text: pair.correctObsDiff, correct: true},
                {text: "Both compounds give a positive result", correct: false},
                {text: "No observable change for either compound", correct: false},
                {text: falseAttribution, correct: false} 
            ];
            return options.sort(() => 0.5 - Math.random());
        }

        const ALL_ORGANIC_PAIRS = COMPLEX_PAIRS.map(pair => {
            const allTestOptions = [
                {id:'1',text:"Add Br₂ (dissolved in organic solvent)"},
                {id:'2',text:"Add Na₂CO₃(aq)"},
                {id:'3',text:"Add Tollen's Reagent and warm"},
                {id:'4',text:"Add 2,4-Dinitrophenylhydrazine"},
                {id:'5',text:"Add acidified K₂Cr₂O₇ and warm"},
                {id:'6',text:"Add acidified KMnO₄"}
            ];

            const filteredOptions = pair.removeOption 
                ? allTestOptions.filter(o => o.text !== pair.removeOption) 
                : allTestOptions;

            let finalOptions = filteredOptions.filter(o => o.text !== pair.correctTest)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
            
            finalOptions.push({id: '99', text: pair.correctTest});
            
            return {
                ...pair,
                options: finalOptions.sort(() => 0.5 - Math.random()), 
                obsOptions: generateDistractors(pair)
            };
        });

        const App = () => {
            const [mode, setMode] = useState('menu'); 
            const [mysterySalt, setMysterySalt] = useState(null);
            const [report, setReport] = useState([]);
            const [selectedCation, setSelectedCation] = useState('');
            const [selectedAnion, setSelectedAnion] = useState('');
            const [inorganicFeedback, setInorganicFeedback] = useState(null);
            const [currentPair, setCurrentPair] = useState(null);
            const [organicPhase, setOrganicPhase] = useState('reagent'); 
            const [organicFeedback, setOrganicFeedback] = useState(null);
            const [notepad, setNotepad] = useState({});

            const startInorganic = () => {
                const salt = generateMysteryCompound();
                setMysterySalt(salt);
                setReport(getTestReport(salt.cation, salt.anion));
                setSelectedCation('');
                setSelectedAnion('');
                setInorganicFeedback(null);
                setNotepad({});
                setMode('inorganic');
            };

            const toggleNote = (id) => {
                setNotepad(prev => ({...prev, [id]: !prev[id]}));
            };

            const checkInorganic = () => {
                if (selectedCation === mysterySalt.cation.id && selectedAnion === mysterySalt.anion.id) {
                    setInorganicFeedback('correct');
                } else {
                    setInorganicFeedback('incorrect');
                }
            };

            const showInorganicAnswer = () => {
                setSelectedCation(mysterySalt.cation.id);
                setSelectedAnion(mysterySalt.anion.id);
                setInorganicFeedback('revealed');
            };

            const startOrganic = () => {
                const randomIndex = Math.floor(Math.random() * ALL_ORGANIC_PAIRS.length);
                const pair = ALL_ORGANIC_PAIRS[randomIndex];
                const hasCorrect = pair.options.some(o => o.text === pair.correctTest);
                if (!hasCorrect) {
                    pair.options[0] = {id:'99', text: pair.correctTest};
                    pair.options.sort(() => 0.5 - Math.random());
                }
                setCurrentPair(pair);
                setOrganicPhase('reagent');
                setOrganicFeedback(null);
                setMode('organic');
            };

            const checkOrganicReagent = (testText) => {
                if (testText === currentPair.correctTest) {
                    setOrganicPhase('observation');
                } else {
                    setOrganicFeedback({ correct: false, msg: `Incorrect Reagent. \n${testText} is not the best choice to distinguish these.` });
                    setOrganicPhase('result');
                }
            };

            const checkOrganicObs = (obsText) => {
                if (obsText === currentPair.obsOptions.find(o => o.correct).text) {
                    setOrganicFeedback({ correct: true, msg: "Excellent! You identified the correct test and observation." });
                } else {
                    setOrganicFeedback({ correct: false, msg: "Right reagent, but wrong observation." });
                }
                setOrganicPhase('result');
            };

            const showOrganicAnswer = () => {
                const correctObs = currentPair.obsOptions.find(o => o.correct).text;
                setOrganicFeedback({
                    correct: true, 
                    isReveal: true,
                    msg: `The correct test is ${currentPair.correctTest}. \nObservation: ${correctObs}`
                });
                setOrganicPhase('result');
            };

            const retryOrganic = () => {
                setOrganicPhase('reagent');
                setOrganicFeedback(null);
            }

            const renderMenu = () => (
                <div className="min-h-screen bg-slate-50 flex flex-col items-center justify-center p-4">
                    <div className="max-w-4xl w-full text-center mb-12">
                        <h1 className="text-5xl font-extrabold text-slate-800 mb-4 tracking-tight">ChemLab: DSE Analysis</h1>
                        <p className="text-slate-500 text-xl">Interactive Qualitative Analysis Trainer</p>
                    </div>

                    <div className="grid md:grid-cols-2 gap-8 max-w-5xl w-full">
                        <button onClick={startInorganic} className="group relative bg-white border-2 border-indigo-100 rounded-3xl p-8 hover:border-indigo-500 hover:shadow-2xl transition-all duration-300 text-left overflow-hidden">
                            <div className="absolute top-0 right-0 bg-indigo-50 w-32 h-32 rounded-full -mr-10 -mt-10 group-hover:scale-150 transition-transform duration-500"></div>
                            <div className="relative z-10">
                                <div className="bg-indigo-600 w-14 h-14 rounded-2xl flex items-center justify-center mb-6 shadow-lg group-hover:rotate-12 transition-transform"><FlaskConical className="text-white w-8 h-8" /></div>
                                <h2 className="text-2xl font-bold text-slate-800 mb-2">Inorganic Lab Report</h2>
                                <p className="text-slate-500 mb-4">Randomly generated mystery salts. Deduce the cation and anion from 10+ standard tests.</p>
                                <div className="flex flex-wrap gap-2 text-xs font-bold text-indigo-600"><span className="bg-indigo-50 px-2 py-1 rounded">60+ Combinations</span></div>
                            </div>
                        </button>

                        <button onClick={startOrganic} className="group relative bg-white border-2 border-emerald-100 rounded-3xl p-8 hover:border-emerald-500 hover:shadow-2xl transition-all duration-300 text-left overflow-hidden">
                            <div className="absolute top-0 right-0 bg-emerald-50 w-32 h-32 rounded-full -mr-10 -mt-10 group-hover:scale-150 transition-transform duration-500"></div>
                            <div className="relative z-10">
                                <div className="bg-emerald-600 w-14 h-14 rounded-2xl flex items-center justify-center mb-6 shadow-lg group-hover:-rotate-12 transition-transform"><Beaker className="text-white w-8 h-8" /></div>
                                <h2 className="text-2xl font-bold text-slate-800 mb-2">Organic Distinction</h2>
                                <p className="text-slate-500 mb-4">Compare pairs of complex polyfunctional compounds (5+ carbons).</p>
                                <div className="flex flex-wrap gap-2 text-xs font-bold text-emerald-600"><span className="bg-emerald-50 px-2 py-1 rounded">30+ Pairs</span><span className="bg-emerald-50 px-2 py-1 rounded">Polyfunctional</span></div>
                            </div>
                        </button>
                    </div>
                </div>
            );

            const renderInorganic = () => (
                <div className="min-h-screen bg-slate-100 flex flex-col pb-12">
                    <div className="bg-indigo-900 text-white p-4 shadow-lg sticky top-0 z-30">
                        <div className="max-w-6xl mx-auto flex justify-between items-center">
                            <button onClick={() => setMode('menu')} className="flex items-center gap-2 hover:bg-white/10 px-3 py-1 rounded-lg transition-colors"><ArrowRight className="rotate-180 w-5 h-5"/> Back</button>
                            <h2 className="font-bold text-lg hidden md:block">Inorganic Qualitative Analysis</h2>
                            <button onClick={startInorganic} className="bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 shadow-lg"><RefreshCw size={16} /> New Sample</button>
                        </div>
                    </div>
                    <div className="flex-grow p-4 md:p-6 max-w-6xl mx-auto w-full grid lg:grid-cols-3 gap-6">
                        
                        {/* --- LEFT COLUMN: LAB REPORT (RESULTS) --- */}
                        <div className="lg:col-span-2 space-y-4">
                            <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                <div className="bg-slate-50 p-4 border-b border-slate-200 flex items-center gap-3"><FileText className="text-indigo-600" /><h3 className="font-bold text-slate-800">Laboratory Report: Unknown Salt X</h3></div>
                                <div className="divide-y divide-slate-100">
                                    {report.map((row, idx) => (
                                        <div key={idx} className="p-4 hover:bg-slate-50 transition-colors grid md:grid-cols-4 gap-2">
                                            <div className="font-semibold text-slate-700 md:col-span-1 text-sm">{row.test}</div>
                                            <div className="text-slate-600 md:col-span-3 text-sm font-mono bg-slate-50 p-2 rounded border border-slate-100">{row.obs}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* --- RIGHT COLUMN: DEDUCTION NOTEPAD --- */}
                        <div className="space-y-4 h-full">
                            <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden p-6 h-full">
                                <div className="flex items-center gap-2 mb-4 text-slate-700 font-bold uppercase tracking-wider text-sm">
                                    <PenTool size={18} /> Deduction Notepad
                                </div>
                                <p className="text-xs text-slate-400 mb-4">Click items to toggle possibilities on/off.</p>
                                <div className="grid grid-cols-1 gap-6">
                                    <div>
                                        <h4 className="text-xs font-bold text-slate-400 mb-2">CATIONS</h4>
                                        <div className="flex flex-wrap gap-2">
                                            {CATIONS.map(ion => (
                                                <button 
                                                    key={ion.id} 
                                                    onClick={() => toggleNote(ion.id)}
                                                    className={`px-3 py-1.5 rounded-full text-xs font-bold transition-all border-2 ${
                                                        notepad[ion.id] 
                                                        ? 'bg-blue-500 border-blue-500 text-white shadow-md scale-105' 
                                                        : 'bg-slate-50 border-slate-200 text-slate-400 hover:border-blue-300'
                                                    }`}
                                                >
                                                    {ion.simpleName} {notepad[ion.id] && <CheckCircle2 className="inline w-3 h-3 ml-1"/>}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div>
                                        <h4 className="text-xs font-bold text-slate-400 mb-2">ANIONS</h4>
                                        <div className="flex flex-wrap gap-2">
                                            {ANIONS.map(ion => (
                                                <button 
                                                    key={ion.id} 
                                                    onClick={() => toggleNote(ion.id)}
                                                    className={`px-3 py-1.5 rounded-full text-xs font-bold transition-all border-2 ${
                                                        notepad[ion.id] 
                                                        ? 'bg-indigo-500 border-indigo-500 text-white shadow-md scale-105' 
                                                        : 'bg-slate-50 border-slate-200 text-slate-400 hover:border-indigo-300'
                                                    }`}
                                                >
                                                    {ion.simpleName} {notepad[ion.id] && <CheckCircle2 className="inline w-3 h-3 ml-1"/>}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* --- BOTTOM ROW: FINAL ANSWER (Full Width) --- */}
                        <div className="lg:col-span-3 mt-4">
                            <div className="bg-white p-6 rounded-xl shadow-lg border-t-4 border-indigo-600">
                                <div className="flex items-center justify-between mb-6">
                                    <h3 className="font-bold text-xl text-slate-800">Analysis Result</h3>
                                    <p className="text-sm text-slate-500">Submit your final deduction.</p>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <div><label className="block text-xs font-bold text-indigo-900 uppercase mb-1">Cation</label><select value={selectedCation} onChange={(e) => setSelectedCation(e.target.value)} className="w-full p-3 bg-indigo-50 border-none rounded-lg text-indigo-900 font-bold focus:ring-2 focus:ring-indigo-500 outline-none"><option value="">Select Cation...</option>{CATIONS.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}</select></div>
                                    <div><label className="block text-xs font-bold text-indigo-900 uppercase mb-1">Anion</label><select value={selectedAnion} onChange={(e) => setSelectedAnion(e.target.value)} className="w-full p-3 bg-indigo-50 border-none rounded-lg text-indigo-900 font-bold focus:ring-2 focus:ring-indigo-500 outline-none"><option value="">Select Anion...</option>{ANIONS.map(a => <option key={a.id} value={a.id}>{a.name}</option>)}</select></div>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={showInorganicAnswer} className="flex-1 py-4 bg-white border-2 border-indigo-200 hover:bg-indigo-50 text-indigo-700 rounded-xl font-bold shadow-sm transition-all flex items-center justify-center gap-2"><Eye size={18} /> Show Answer</button>
                                    <button onClick={checkInorganic} disabled={!selectedCation || !selectedAnion || (inorganicFeedback === 'correct' || inorganicFeedback === 'revealed')} className="flex-1 py-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-slate-300 disabled:text-slate-500 text-white rounded-xl font-bold shadow-lg shadow-indigo-200 transition-all">Submit</button>
                                </div>
                                
                                {inorganicFeedback && (
                                    <div className={`mt-6 p-4 rounded-xl border-2 text-center animate-fade-in-up ${inorganicFeedback === 'correct' || inorganicFeedback === 'revealed' ? 'bg-emerald-50 border-emerald-100 text-emerald-800' : 'bg-red-50 border-red-100 text-red-800'}`}>
                                        {(inorganicFeedback === 'correct' || inorganicFeedback === 'revealed') ? (<><CheckCircle2 className="w-8 h-8 mx-auto mb-2 text-emerald-600" /><div className="font-bold text-lg">{inorganicFeedback === 'revealed' ? 'Answer Revealed' : 'Correct Analysis!'}</div><div className="text-sm mt-1 opacity-80">The compound is {CATIONS.find(c=>c.id===mysterySalt.cation.id).simpleName} {ANIONS.find(a=>a.id===mysterySalt.anion.id).simpleName}.</div></>) : (<><XCircle className="w-8 h-8 mx-auto mb-2 text-red-600" /><div className="font-bold text-lg">Incorrect.</div><div className="text-sm mt-1 opacity-80">Check the solubility, flame test, and reagent observations again.</div></>)}
                                    </div>
                                )}
                            </div>
                        </div>

                    </div>
                </div>
            );

            const renderOrganic = () => (
                <div className="min-h-screen bg-slate-100 flex flex-col pb-12">
                    <div className="bg-emerald-900 text-white p-4 shadow-lg sticky top-0 z-30">
                        <div className="max-w-4xl mx-auto flex justify-between items-center">
                            <button onClick={() => setMode('menu')} className="flex items-center gap-2 hover:bg-white/10 px-3 py-1 rounded-lg transition-colors"><ArrowRight className="rotate-180 w-5 h-5"/> Back</button>
                            <h2 className="font-bold text-lg hidden md:block">Organic Distinction</h2>
                            <button onClick={startOrganic} className="bg-emerald-600 hover:bg-emerald-500 px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 shadow-lg"><RefreshCw size={16} /> New Pair</button>
                        </div>
                    </div>
                    <div className="flex-grow p-4 flex items-center justify-center">
                        <div className="max-w-4xl w-full bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
                            <div className="grid md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-slate-100">
                                <div className="p-8 text-center bg-slate-50/50"><div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm h-48 flex items-center justify-center mb-4">{currentPair.structA}</div><h3 className="font-bold text-xl text-slate-800">{currentPair.nameA}</h3></div>
                                <div className="p-8 text-center bg-slate-50/50"><div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm h-48 flex items-center justify-center mb-4">{currentPair.structB}</div><h3 className="font-bold text-xl text-slate-800">{currentPair.nameB}</h3></div>
                            </div>
                            <div className="p-8 bg-white border-t border-slate-100 relative">
                                {(organicPhase === 'reagent' || organicPhase === 'observation') && (<div className="absolute top-4 right-4"><button onClick={showOrganicAnswer} className="text-xs font-bold text-slate-400 hover:text-emerald-600 flex items-center gap-1 bg-slate-100 hover:bg-emerald-50 px-3 py-1.5 rounded-full transition-colors"><Eye size={14} /> Show Answer</button></div>)}
                                <div className={`transition-all duration-500 ${organicPhase === 'reagent' ? 'opacity-100 translate-y-0' : 'hidden opacity-0 translate-y-10'}`}>
                                    <h3 className="text-center font-bold text-slate-400 uppercase tracking-widest text-sm mb-6">Step 1: Choose the Distinguishing Reagent</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">{currentPair.options.map(opt => (<button key={opt.id} onClick={() => checkOrganicReagent(opt.text)} className="p-4 border-2 border-slate-200 rounded-xl hover:border-emerald-500 hover:bg-emerald-50 text-slate-700 font-medium transition-all text-left">{opt.text}</button>))}</div>
                                </div>
                                <div className={`transition-all duration-500 ${organicPhase === 'observation' ? 'opacity-100 translate-y-0' : 'hidden opacity-0 translate-y-10'}`}>
                                    <div className="flex items-center justify-center gap-2 mb-6 text-emerald-600 font-bold bg-emerald-50 py-2 rounded-lg"><CheckCircle2 size={20}/><span>Correct Reagent Selected!</span></div>
                                    <h3 className="text-center font-bold text-slate-400 uppercase tracking-widest text-sm mb-6">Step 2: Identify the Observation Difference</h3>
                                    <div className="grid grid-cols-1 gap-3">{currentPair.obsOptions.map((opt, idx) => (<button key={idx} onClick={() => checkOrganicObs(opt.text)} className="p-4 border-2 border-slate-200 rounded-xl hover:border-emerald-500 hover:bg-emerald-50 text-slate-700 font-medium transition-all text-left">{opt.text}</button>))}</div>
                                </div>
                                {organicPhase === 'result' && organicFeedback && (
                                    <div className="text-center animate-fade-in-up">
                                        <div className={`inline-block p-4 rounded-full mb-4 ${organicFeedback.correct ? 'bg-emerald-100 text-emerald-600' : 'bg-red-100 text-red-600'}`}>{organicFeedback.isReveal ? <BookOpen size={40} /> : (organicFeedback.correct ? <Trophy size={40} /> : <AlertTriangle size={40} />)}</div>
                                        <h2 className="text-2xl font-bold text-slate-800 mb-2">{organicFeedback.isReveal ? 'Answer Revealed' : (organicFeedback.correct ? 'Correct!' : 'Try Again')}</h2>
                                        <p className="text-slate-600 mb-8 whitespace-pre-line">{organicFeedback.msg}</p>
                                        <div className="flex justify-center gap-4">
                                            {!organicFeedback.correct && !organicFeedback.isReveal && (<button onClick={retryOrganic} className="bg-white border-2 border-slate-300 text-slate-700 px-8 py-3 rounded-xl font-bold hover:bg-slate-50 transition-colors shadow-sm flex items-center gap-2"><RotateCcw size={18} /> Try Again</button>)}
                                            <button onClick={startOrganic} className="bg-slate-800 text-white px-8 py-3 rounded-xl font-bold hover:bg-slate-700 transition-colors shadow-lg flex items-center gap-2">{organicFeedback.correct || organicFeedback.isReveal ? 'Next Pair' : 'Skip Pair'} <ArrowRight size={18} /></button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <>
                    {mode === 'menu' && renderMenu()}
                    {mode === 'inorganic' && renderInorganic()}
                    {mode === 'organic' && renderOrganic()}
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
